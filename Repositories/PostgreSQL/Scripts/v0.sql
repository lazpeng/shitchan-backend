-- Version 0 upgrade script

-- Contains information about currently installed versions
CREATE TABLE IF NOT EXISTS DBUPGRADE (
    VERSION INT PRIMARY KEY,
    DATEINSTALLED TIMESTAMP NOT NULL
);

CREATE TABLE IF NOT EXISTS ADMINS (
    ID SERIAL PRIMARY KEY,
    USERNAME VARCHAR(128) UNIQUE NOT NULL,
    PASSWORDHASH CHAR(64) NOT NULL,
    PASSWORDSALT CHAR(36) NOT NULL,
    DATEREGISTERED BIGINT NOT NULL
);

CREATE TABLE IF NOT EXISTS BOARDS (
    ROUTE VARCHAR(4) PRIMARY KEY,
    TITLE TEXT NOT NULL,
    DESCRIPTION TEXT NOT NULL,
    CREATEDBY INT NOT NULL,
    CONSTRAINT FK_BOARDS_CREATEDBY FOREIGN KEY (CREATEDBY) REFERENCES ADMINS (ID)
);

CREATE TABLE IF NOT EXISTS POSTS (
    ID BIGSERIAL PRIMARY KEY,
    BOARD VARCHAR(4) NOT NULL,
    TITLE VARCHAR(128),
    AUTHOR VARCHAR(128) DEFAULT 'Anonymous',
    POSTED BIGINT NOT NULL,
    CONTENT VARCHAR(256) NOT NULL,
    HASH CHAR(36) NOT NULL,
    PARENT BIGINT,
    FILENAME VARCHAR(128),
    FILEDATA BYTEA,
    CONSTRAINT FK_POST_PARENT FOREIGN KEY (PARENT) REFERENCES POSTS (ID) ON DELETE CASCADE,
    CONSTRAINT FK_POST_BOARD FOREIGN KEY (BOARD) REFERENCES BOARDS (ROUTE) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS INVITES (
    INVITE CHAR(36) PRIMARY KEY
);

-- DEFAULT INVITE FOR ROOT ADMIN. DELETED WHEN USED
INSERT INTO INVITES VALUES ('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX');

CREATE TABLE IF NOT EXISTS SESSIONS (
    TOKEN CHAR(36) PRIMARY KEY,
    ADMIN INT NOT NULL
);